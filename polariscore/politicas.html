<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <link rel="apple-touch-icon" sizes="76x76" href="../assets/img/apple-icon.png">
  <link rel="icon" type="image/png" href="../assets/img/polariscore/icono.png">
  <title>
    Lista de politicas
  </title>
  <!--     Fonts and icons     -->
  <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,600,700" rel="stylesheet" />
  <!-- Nucleo Icons -->
  <link href="../assets/css/nucleo-icons.css" rel="stylesheet" />
  <link href="../assets/css/nucleo-svg.css" rel="stylesheet" />
  <!-- Font Awesome Icons -->
  <script src="https://kit.fontawesome.com/aa4ade8d2d.js" crossorigin="anonymous"></script>
  <link href="../assets/css/nucleo-svg.css" rel="stylesheet" />
  <!-- CSS Files -->
  <link id="pagestyle" href="../assets/css/argon-dashboard.css" rel="stylesheet" />
</head>

<body class="g-sidenav-show bg-gray-100">
  <div class="min-height-300 position-absolute w-100"
    style="background: url('../assets/img/polariscore/bg-gradient.png') no-repeat center center/cover;">
  </div>
  <aside
    class="sidenav bg-white navbar navbar-vertical navbar-expand-xs border-0 border-radius-xl my-3 fixed-start ms-4"
    id="sidenav-main" style="z-index:1040;">
    <div class="sidenav-header mb-3">
      <a class="navbar-brand m-0 d-flex flex-column align-items-center" href="../index.html">
        <!-- Logo institucional Argon -->
        <img src="../assets/img/polariscore/logo.png" class="navbar-brand-img mb-0" style="max-height:60px;"
          alt="main_logo">

      </a>
    </div>
    <hr class="horizontal dark mt-0 mb-2">
    <div class="collapse navbar-collapse w-auto" id="sidenav-collapse-main">
      <ul class="navbar-nav">

        <!-- Pol√≠ticas -->
        <li class="nav-item">
          <a class="nav-link d-flex align-items-center gap-2" href="#" data-bs-toggle="collapse"
            data-bs-target="#submenuPoliticas" aria-expanded="false">
            <i class="fa-solid fa-landmark text-success"></i>
            <span class="nav-link-text">Pol√≠ticas</span>
          </a>
          <ul class="collapse list-unstyled ms-4" id="submenuPoliticas">
            <li><a class="nav-link" href="../polariscore/dashboard.html"><i
                  class="fa-solid fa-chart-pie text-success"></i> An√°lisis General</a></li>
            <li><a class="nav-link" href="../polariscore/politicas.html"><i
                  class="fa-solid fa-list-ul text-primary"></i> Lista de Pol√≠ticas</a></li>
            <li class="admin-responsable-only" style="display: none;"><a class="nav-link"
                href="../polariscore/politicas.html?t="><i class="fa-regular fa-folder-open text-info"></i> Mis
                Pol√≠ticas</a></li>
            <li><a class="nav-link" href="../polariscore/observaciones.html"><i
                  class="fa-regular fa-comment-dots text-info"></i> Observaciones</a></li>
          </ul>
        </li>

        <!-- Seleccionar Pol√≠tica -->
        <li class="nav-item">
          <a class="nav-link d-flex align-items-center gap-2 active" href="#" data-bs-toggle="collapse"
            data-bs-target="#cargarPoliticas" aria-expanded="true">
            <i class="fa-solid fa-gavel text-warning"></i>
            <span class="nav-link-text">Seleccionar pol√≠tica</span>
          </a>
          <ul class="collapse show list-unstyled ms-4" id="cargarPoliticas"></ul>
        </li>

        <!-- Otras Apps -->
        <li class="nav-item">
          <a class="nav-link d-flex align-items-center gap-2 collapsed" href="#" data-bs-toggle="collapse"
            data-bs-target="#submenuPdi" aria-expanded="false">
            <i class="fa-solid fa-rocket text-danger"></i>
            <span class="nav-link-text">Otras Apps</span>
          </a>
          <ul class="collapse list-unstyled ms-4" id="submenuPdi">
            <li>
              <a class="nav-link" href="https://sigunitropico.com" target="_blank">
                <i class="fa-solid fa-globe text-danger"></i> SIG Unitr√≥pico
              </a>
            </li>
            <li>
              <a class="nav-link" href="https://sigunitropico.com/planeacion" target="_blank">
                <i class="fa-solid fa-chart-line text-info"></i> Planeaci√≥n
              </a>
            </li>
          </ul>
        </li>

        <!-- Admin (solo visible para admins) -->
        <li class="nav-item mt-3 admin-only admin-polariscore" style="display: none;">
          <h6 class="ps-4 ms-2 text-uppercase text-xs font-weight-bolder opacity-6">Administraci√≥n</h6>
        </li>
        <li class="nav-item admin-only admin-polariscore" style="display: none;">
          <a class="nav-link d-flex align-items-center gap-2" href="../pages/usuarios.html" target="_blank">
            <i class="fa-solid fa-users text-danger"></i>
            <span class="nav-link-text">Usuarios</span>
          </a>
        </li>
      </ul>
    </div>

    <!-- Login/Logout Aside: centrado y sin overlap -->
    <div class="sidenav-footer w-100 text-center mt-auto pb-3">

      <div class="card card-plain shadow-none mb-2" id="sidenavCard">
        <img class="w-80 mx-auto" src="../assets/img/illustrations/logo-simbolo-unitropico-1.png"
          alt="sidebar_illustration">
        <div class="card-body text-center p-2 w-100 pt-0">
          <div class="docs-info">
            <h6 class="mb-0">¬øNecesitas ayuda?</h6>
            <p class="text-xs font-weight-bold mb-0">Por favor revisa nuestras gu√≠as</p>
          </div>
        </div>
      </div>
      <div id="asideAuthBtn" class="mb-2 d-flex flex-column align-items-center"></div>
      <a href="https://www.creative-tim.com/learning-lab/bootstrap/license/argon-dashboard" target="_blank"
        class="btn btn-dark btn-sm w-70 mb-2"><i class="fa-solid fa-book me-2"></i>Manual de uso</a>
      <a class="btn btn-primary btn-sm w-70 mb-0" href="mailto:innovacionplaneacion@unitropico.edu.co" type="button">
        <i class="fa-solid fa-envelope me-2"></i> Soporte t√©cnico
      </a>

    </div>
  </aside>
  <main class="main-content position-relative border-radius-lg ">
    <!-- Navbar -->
    <style>
      @media (max-width: 768px) {
        .ocultar {
          display: none !important;
        }

        .margin-top-5 {
          margin-top: 5%;
        }

        .resaltar {
          background-color: #00594e;
          border-radius: 0px;
          margin: 0px auto !important;
        }

        .busqueda {
          margin-top: 15%;
        }
      }
    </style>
    <nav class="navbar navbar-main navbar-expand-lg px-0 mx-4 shadow-none border-radius-xl resaltar " id="navbarBlur"
      data-scroll="false">
      <div class="container-fluid py-1 px-3">
        <nav aria-label="breadcrumb">
          <ol class="breadcrumb bg-transparent mb-0 pb-0 pt-1 px-0 me-sm-6 me-5">
            <li class="breadcrumb-item text-sm"><a class="opacity-5 text-white" href="javascript:;">Pol√≠ticas</a></li>
            <li class="breadcrumb-item text-sm text-white active ocultar" aria-current="page">Lista de politicas</li>
          </ol>
          <h6 class="font-weight-bolder text-white mb-0 ocultar">Pol√≠ticas Institucionales</h6>
        </nav>
        <div class="collapse navbar-collapse mt-sm-0 mt-2 me-md-0 me-sm-4" id="navbar">
          <div class="ms-md-auto pe-md-3 d-flex align-items-center">

          </div>
          <ul class="navbar-nav  justify-content-end">
            <li class="nav-item d-xl-none ps-3 d-flex align-items-center">
              <a href="javascript:;" class="nav-link text-white p-0" id="iconNavbarSidenav">
                <div class="sidenav-toggler-inner">
                  <i class="sidenav-toggler-line bg-white"></i>
                  <i class="sidenav-toggler-line bg-white"></i>
                  <i class="sidenav-toggler-line bg-white"></i>
                </div>
              </a>
            </li>
            <li class="nav-item px-3 d-flex align-items-center">
              <a href="javascript:;" class="nav-link text-white p-0">
                <i class="fa fa-cog fixed-plugin-button-nav cursor-pointer"></i>
              </a>
            </li>

            <li class="nav-item dropdown pe-2 d-flex align-items-center">
              <a href="javascript:;" class="nav-link text-white p-0" id="dropdownMenuButton" data-bs-toggle="dropdown"
                aria-expanded="false">
                <i class="fa fa-bell cursor-pointer"></i>
              </a>
              <ul class="dropdown-menu  dropdown-menu-end  px-2 py-3 me-sm-n4" aria-labelledby="dropdownMenuButton">
                <li class="mb-2">
                  <a class="dropdown-item border-radius-md" href="javascript:;">
                    <div class="d-flex py-1">
                      <div class="my-auto">
                        <img src="../assets/img/team-2.jpg" class="avatar avatar-sm  me-3 ">
                      </div>
                      <div class="d-flex flex-column justify-content-center">
                        <h6 class="text-sm font-weight-normal mb-1">
                          <span class="font-weight-bold">New message</span> from Laur
                        </h6>
                        <p class="text-xs text-secondary mb-0">
                          <i class="fa fa-clock me-1"></i>
                          13 minutes ago
                        </p>
                      </div>
                    </div>
                  </a>
                </li>
                <li class="mb-2">
                  <a class="dropdown-item border-radius-md" href="javascript:;">
                    <div class="d-flex py-1">
                      <div class="my-auto">
                        <img src="../assets/img/small-logos/logo-spotify.svg"
                          class="avatar avatar-sm bg-gradient-dark  me-3 ">
                      </div>
                      <div class="d-flex flex-column justify-content-center">
                        <h6 class="text-sm font-weight-normal mb-1">
                          <span class="font-weight-bold">New album</span> by Travis Scott
                        </h6>
                        <p class="text-xs text-secondary mb-0">
                          <i class="fa fa-clock me-1"></i>
                          1 day
                        </p>
                      </div>
                    </div>
                  </a>
                </li>
                <li>
                  <a class="dropdown-item border-radius-md" href="javascript:;">
                    <div class="d-flex py-1">
                      <div class="avatar avatar-sm bg-gradient-secondary  me-3  my-auto">
                        <svg width="12px" height="12px" viewBox="0 0 43 36" version="1.1"
                          xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
                          <title>credit-card</title>
                          <g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
                            <g transform="translate(-2169.000000, -745.000000)" fill="#FFFFFF" fill-rule="nonzero">
                              <g transform="translate(1716.000000, 291.000000)">
                                <g transform="translate(453.000000, 454.000000)">
                                  <path class="color-background"
                                    d="M43,10.7482083 L43,3.58333333 C43,1.60354167 41.3964583,0 39.4166667,0 L3.58333333,0 C1.60354167,0 0,1.60354167 0,3.58333333 L0,10.7482083 L43,10.7482083 Z"
                                    opacity="0.593633743"></path>
                                  <path class="color-background"
                                    d="M0,16.125 L0,32.25 C0,34.2297917 1.60354167,35.8333333 3.58333333,35.8333333 L39.4166667,35.8333333 C41.3964583,35.8333333 43,34.2297917 43,32.25 L43,16.125 L0,16.125 Z M19.7083333,26.875 L7.16666667,26.875 L7.16666667,23.2916667 L19.7083333,23.2916667 L19.7083333,26.875 Z M35.8333333,26.875 L28.6666667,26.875 L28.6666667,23.2916667 L35.8333333,23.2916667 L35.8333333,26.875 Z">
                                  </path>
                                </g>
                              </g>
                            </g>
                          </g>
                        </svg>
                      </div>
                      <div class="d-flex flex-column justify-content-center">
                        <h6 class="text-sm font-weight-normal mb-1">
                          Payment successfully completed
                        </h6>
                        <p class="text-xs text-secondary mb-0">
                          <i class="fa fa-clock me-1"></i>
                          2 days
                        </p>
                      </div>
                    </div>
                  </a>
                </li>
              </ul>
            </li>

            <li class="nav-item dropdown pe-2 d-flex align-items-center">
              <div id="perfilUsuario" class="d-flex align-items-center gap-2" data-bs-toggle="dropdown" role="button"
                aria-expanded="false">
                <img id="imgPerfilUsuario" src="https://ui-avatars.com/api/?name=Usuario" alt="Foto"
                  class="rounded-circle border" width="40" height="40" style="object-fit:cover;">
              </div>
              <ul class="dropdown-menu dropdown-menu-end px-2 py-3 me-sm-n4" aria-labelledby="perfilUsuario">
                <li>
                  <a class="dropdown-item border-radius-md" href="../pages/profile.html">
                    <div class="d-flex py-1 align-items-center">
                      <div class="my-auto">
                        <img id="imgPerfilUsuarioDropdown" src="https://ui-avatars.com/api/?name=Usuario"
                          class="avatar avatar-sm me-3 rounded-circle border" style="object-fit:cover;">
                      </div>
                      <div class="d-flex flex-column justify-content-center">
                        <h6 class="mb-0 text-sm text-default fw-bold" id="nombrePerfilUsuario"> Usuario</h6>
                        <small class="text-xs text-muted mb-0" id="correoPerfilUsuario">Correo</small>
                      </div>
                    </div>
                  </a>
                </li>
                <li>
                  <a class="dropdown-item border-radius-md" id="rolesUsuario">
                    <i class="fas fa-user-circle text-primary me-2"></i> Mi perfil
                  </a>
                </li>
                <li>
                  <button id="logButton" class="dropdown-item border-radius-md text-danger d-flex align-items-center">
                    <span><i class="fa-solid fa-arrow-right-from-bracket"></i> Cerrar sesi√≥n</span>
                  </button>
                  <style>
                    /* Soluciona contraste para bot√≥n rojo dentro de dropdown Bootstrap */
                    #logButton.dropdown-item.text-danger:hover,
                    #logButton.dropdown-item.text-danger:focus {
                      background-color: #dc3545 !important;
                      /* danger */
                      color: #fff !important;
                      /* blanco */
                      border-radius: .5rem;
                    }

                    #logButton.dropdown-item.text-danger:hover i,
                    #logButton.dropdown-item.text-danger:focus i {
                      color: #fff !important;
                    }
                  </style>
                </li>
              </ul>
            </li>


          </ul>
        </div>
      </div>
    </nav>
    <!-- End Navbar -->

    <!---  CONTENIDO ---->

    <div class="input-group mb-3 busqueda" style="max-width: 60%; margin: 5% auto;">
      <span class="input-group-text text-body">
        <i class="fas fa-search" id="iconBuscar"></i>
      </span>
      <input type="text" class="form-control " id="inputBuscarPoliticas" placeholder="¬øQu√© pol√≠tica est√°s buscando?...">
    </div>

    <div class="container-fluid py-4">
      <div class="row">
        <div class="col-12">
          <div class="card mb-4">
            <div class="card-header pb-0">
              <h6>Seguimiento de las Pol√≠ticas Institucionales</h6>
              <p class="text-xs text-muted mt-1" id="contadorResultados"></p>
              <div class="form-check mb-3 admin-responsable-only" style="display: none;">
                <input class="form-check-input" type="checkbox" value="" id="checkMisPoliticas">
                <label class="form-check-label" for="checkMisPoliticas">
                  Ver solo mis pol√≠ticas
                </label>
              </div>


            </div>
            <div class="card-body px-0 pt-0 pb-2">
              <div class="table-responsive p-0" id="tableContainer">
                <!-- Spinner visible inicialmente -->
                <div id="spinner" class="spinner-border text-primary" role="status"
                  style="margin: 20px auto; display: block;">
                  <span class="visually-hidden">Loading...</span>
                </div>
                <!-- La tabla se oculta inicialmente -->
                <table class="table align-items-center mb-0" id="tablaPoliticasTable" style="display: none;">
                  <thead id="politicasTh"></thead>
                  <tbody id="tablaPoliticas"></tbody>
                </table>
              </div>
            </div>
          </div>
        </div>
      </div>
      <!--- FIN DEL CONTENIDO ---->
    </div>

    <footer class="footer pt-3  ">
      <div class="container-fluid">
        <div class="row align-items-center justify-content-lg-between">
          <div class="col-lg-6 mb-lg-0 mb-4">
            <div class="copyright text-center text-sm text-muted text-lg-start">
              ¬©
              <script>
                document.write(new Date().getFullYear())
              </script>,
              desarrollado por la <a style="font-weight: 600; color: #00584e;"
                href="https://sigunitropico.com/planeacion-estrategica">Oficina Asesora de Planeaci√≥n</a> - Unitr√≥pico

            </div>
          </div>
          <div class="col-lg-6">
            <ul class="nav nav-footer justify-content-center justify-content-lg-end">
              <li class="nav-item">
                <a href="synariscorp.com" class="nav-link text-muted" target="_blank">Synaris Corp</a>
              </li>
              <li class="nav-item">
                <a href="synariscorp.com" class="nav-link text-muted" target="_blank">Nosotros</a>
              </li>
              <li class="nav-item">
                <a href="synariscorp.com" class="nav-link text-muted" target="_blank">Blog</a>
              </li>
              <li class="nav-item">
                <a href="synariscorp.com" class="nav-link pe-0 text-muted" target="_blank">Licencia</a>
              </li>
            </ul>
          </div>
        </div>
      </div>
    </footer>
    </div>
  </main>
  <div class="fixed-plugin">
    <a class="fixed-plugin-button text-dark position-fixed px-3 py-2">
      <i class="fa fa-cog py-2"> </i>
    </a>
    <div class="card shadow-lg">
      <div class="card-header pb-0 pt-3 ">
        <div class="float-start">
          <h5 class="mt-3 mb-0">Argon Configurator</h5>
          <p>See our dashboard options.</p>
        </div>
        <div class="float-end mt-4">
          <button class="btn btn-link text-dark p-0 fixed-plugin-close-button">
            <i class="fa fa-close"></i>
          </button>
        </div>
        <!-- End Toggle Button -->
      </div>
      <hr class="horizontal dark my-1">
      <div class="card-body pt-sm-3 pt-0 overflow-auto">
        <!-- Sidebar Backgrounds -->
        <div>
          <h6 class="mb-0">Sidebar Colors</h6>
        </div>
        <a href="javascript:void(0)" class="switch-trigger background-color">
          <div class="badge-colors my-2 text-start">
            <span class="badge filter bg-gradient-primary active" data-color="primary"
              onclick="sidebarColor(this)"></span>
            <span class="badge filter bg-gradient-dark" data-color="dark" onclick="sidebarColor(this)"></span>
            <span class="badge filter bg-gradient-info" data-color="info" onclick="sidebarColor(this)"></span>
            <span class="badge filter bg-gradient-success" data-color="success" onclick="sidebarColor(this)"></span>
            <span class="badge filter bg-gradient-warning" data-color="warning" onclick="sidebarColor(this)"></span>
            <span class="badge filter bg-gradient-danger" data-color="danger" onclick="sidebarColor(this)"></span>
          </div>
        </a>
        <!-- Sidenav Type -->
        <div class="mt-3">
          <h6 class="mb-0">Sidenav Type</h6>
          <p class="text-sm">Choose between 2 different sidenav types.</p>
        </div>
        <div class="d-flex">
          <button class="btn bg-gradient-primary w-100 px-3 mb-2 active me-2" data-class="bg-white"
            onclick="sidebarType(this)">White</button>
          <button class="btn bg-gradient-primary w-100 px-3 mb-2" data-class="bg-default"
            onclick="sidebarType(this)">Dark</button>
        </div>
        <p class="text-sm d-xl-none d-block mt-2">You can change the sidenav type just on desktop view.</p>
        <!-- Navbar Fixed -->
        <div class="d-flex my-3">
          <h6 class="mb-0">Navbar Fixed</h6>
          <div class="form-check form-switch ps-0 ms-auto my-auto">
            <input class="form-check-input mt-1 ms-auto" type="checkbox" id="navbarFixed" onclick="navbarFixed(this)">
          </div>
        </div>
        <hr class="horizontal dark my-sm-4">
        <div class="mt-2 mb-5 d-flex">
          <h6 class="mb-0">Light / Dark</h6>
          <div class="form-check form-switch ps-0 ms-auto my-auto">
            <input class="form-check-input mt-1 ms-auto" type="checkbox" id="dark-version" onclick="darkMode(this)">
          </div>
        </div>
        <a class="btn bg-gradient-dark w-100" href="https://www.creative-tim.com/product/argon-dashboard">Free
          Download</a>
        <a class="btn btn-outline-dark w-100"
          href="https://www.creative-tim.com/learning-lab/bootstrap/license/argon-dashboard">View documentation</a>
        <div class="w-100 text-center">
          <a class="github-button" href="https://github.com/creativetimofficial/argon-dashboard"
            data-icon="octicon-star" data-size="large" data-show-count="true"
            aria-label="Star creativetimofficial/argon-dashboard on GitHub">Star</a>
          <h6 class="mt-3">Thank you for sharing!</h6>
          <a href="https://twitter.com/intent/tweet?text=Check%20Argon%20Dashboard%20made%20by%20%40CreativeTim%20%23webdesign%20%23dashboard%20%23bootstrap5&amp;url=https%3A%2F%2Fwww.creative-tim.com%2Fproduct%2Fargon-dashboard"
            class="btn btn-dark mb-0 me-2" target="_blank">
            <i class="fab fa-twitter me-1" aria-hidden="true"></i> Tweet
          </a>
          <a href="https://www.facebook.com/sharer/sharer.php?u=https://www.creative-tim.com/product/argon-dashboard"
            class="btn btn-dark mb-0 me-2" target="_blank">
            <i class="fab fa-facebook-square me-1" aria-hidden="true"></i> Share
          </a>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal de Confirmaci√≥n de Cierre de Sesi√≥n -->
  <div class="modal fade" id="logoutModal" tabindex="-1" role="dialog" aria-labelledby="logoutLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="logoutLabel">Cerrar sesi√≥n</h5>
        </div>
        <div class="modal-body text-center">
          <p>¬øEst√°s seguro de que quieres cerrar sesi√≥n?</p>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-primary" data-bs-dismiss="modal">Cancelar</button>
          <button type="button" class="btn btn-danger" id="confirmLogout">Cerrar sesi√≥n</button>
        </div>
      </div>
    </div>
  </div>
  <style>
    .sort-icon {
      cursor: pointer;
      margin-left: 5px;
      color: #6c757d;
      /* Color gris inicial */
      transition: color 0.3s ease;
    }

    .sort-icon:hover {
      color: #00594e;
      /* Color primary en hover */
    }

    .form-control:focus {
      border-color: #00594f00;
      box-shadow: 0 0 0 0.2rem rgba(0, 89, 79, 0);
      transition: all 0.3s;
    }
  </style>

  <script type="module">
    import { getFirestore, collection, query, where, getDocs, doc, setDoc } from "https://www.gstatic.com/firebasejs/9.1.2/firebase-firestore.js";
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.1.2/firebase-app.js";
    import { getDatabase, ref, get } from "https://www.gstatic.com/firebasejs/9.1.2/firebase-database.js";
    import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/9.1.2/firebase-auth.js";

    // Configuraci√≥n de Firebase
    const firebaseConfig = {
      apiKey: "AIzaSyADKfjkB9LO1k1smRJ31sOb-7rrxOrQ7lc",
      authDomain: "sigunitropico.firebaseapp.com",
      projectId: "sigunitropico",
      storageBucket: "sigunitropico.appspot.com",
      messagingSenderId: "32992004482",
      appId: "1:32992004482:web:bd4d5e9a2b7a8b976e279b"
    };

    // Inicializar Firebase
    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);
    const auth = getAuth(app);
    const dbFS = getFirestore();

    let idResponsable = null;


    let politicasData = []; // Array global para almacenar los datos

    // Referencias a los elementos del DOM
    const tablaPoliticas = document.getElementById('tablaPoliticas');
    const politicasTh = document.getElementById('politicasTh');

    // Configurar encabezado con eventos de ordenamiento
    politicasTh.innerHTML = `
        <tr>
            <th>ID 
                <i class="fa-solid fa-arrow-up sort-icon" data-sort="id" data-order="asc"></i>
                <i class="fa-solid fa-arrow-down sort-icon" data-sort="id" data-order="desc"></i>
            </th>
            <th>Pol√≠tica</th>
            <th>Cumplimiento 
                <i class="fa-solid fa-arrow-up sort-icon" data-sort="cumplimiento" data-order="asc"></i>
                <i class="fa-solid fa-arrow-down sort-icon" data-sort="cumplimiento" data-order="desc"></i>
            </th>
            <th>Fecha 
                <i class="fa-solid fa-arrow-up sort-icon" data-sort="fecha" data-order="asc"></i>
                <i class="fa-solid fa-arrow-down sort-icon" data-sort="fecha" data-order="desc"></i>
            </th>
        </tr>
    `;

    const iconosPoliticas = {
      "P-001": "fas fa-chalkboard-teacher text-primary",         // Formaci√≥n Profesoral
      "P-002": "fas fa-flask text-success",                      // Investigaci√≥n y Convocatorias
      "P-003": "fas fa-tasks text-info",                         // Autoevaluaci√≥n, Autorregulaci√≥n y Mejoramiento
      "P-004": "fas fa-lightbulb text-warning",                  // Propiedad Intelectual
      "P-005": "fas fa-university text-danger",                  // Acad√©mica
      "P-006": "fas fa-graduation-cap text-secondary",           // Innovaci√≥n Educativa y Buenas Pr√°cticas Pedag√≥gicas
      "P-007": "fas fa-leaf text-success",                       // Ambiental
      "P-008": "fas fa-language text-primary",                   // Ling√º√≠stica
      "P-009": "fas fa-users text-info",                         // Inclusiva e Intercultural (PESII)
      "P-010": "fas fa-heart text-danger",                       // Bienestar Universitario
      "P-011": "fas fa-user-graduate text-warning",               // Egresados
      "P-012": "fas fa-globe-americas text-primary",              // Internacionalizaci√≥n
      "P-013": "fas fa-user-tie text-dark",                       // Gesti√≥n Estrat√©gica de Talento Humano
      "P-014": "fas fa-award text-warning",                       // Incentivos y Est√≠mulos del Personal
      "P-015": "fas fa-chart-bar text-success",                   // Gesti√≥n de la Informaci√≥n Estad√≠stica
      "P-016": "fas fa-balance-scale text-danger",                 // Transparencia y Lucha contra la Corrupci√≥n
      "P-017": "fas fa-headset text-info",                        // Atenci√≥n al Ciudadano
      "P-018": "fas fa-archive text-secondary",                   // Gesti√≥n Documental
      "P-019": "fas fa-tools text-dark",                          // Mantenimiento y Renovaci√≥n de Infraestructura
      "P-020": "fas fa-handshake text-success",                   // Integridad
      "P-021": "fas fa-hands-helping text-primary"                 // Proyecci√≥n Social
    };


    // Funci√≥n para obtener las pol√≠ticas desde Firebase
    async function cargarPoliticas() {
      const spinner = document.getElementById('spinner');
      spinner.style.display = "block"; // Mostrar spinner

      try {
        const snapshot = await get(ref(db, 'PolariScore/politicas'));

        if (!snapshot.exists()) {
          console.warn("‚ö†Ô∏è No hay pol√≠ticas registradas.");
          spinner.style.display = "none";
          return;
        }

        const data = snapshot.val();
        politicasData = []; // Resetear array

        Object.keys(data).forEach((idPolitica) => {
          const politica = data[idPolitica];

          const cumplimientoPolitica = politica.totalPolitica !== undefined
            ? parseFloat(politica.totalPolitica).toFixed(2)
            : 0;

          politicasData.push({
            id: politica.id,
            titulo: politica.titulo,
            cumplimiento: politica.totalPolitica !== undefined
              ? parseFloat(politica.totalPolitica)
              : 0,
            fecha: politica.fecha_politica,
            responsable: politica.responsables
          });
        });

        const ulPoliticas = document.getElementById('cargarPoliticas');
        ulPoliticas.innerHTML = "";

        for (const idPolitica in data) {
          const politica = data[idPolitica];
          const nombrePolitica = politica.titulo || "Sin nombre";

          // Obtener el icono o usar uno por defecto
          const icono = iconosPoliticas[idPolitica] || "fas fa-file-alt text-secondary";

          const li = document.createElement("li");
          li.className = "nav-item";

          li.innerHTML = `
                <a class="nav-link d-flex align-items-center" href="#" title="${nombrePolitica}" data-id="${idPolitica}">
                  <i class="${icono} me-2"></i> 
                  ${limitarTexto(nombrePolitica, 23)}
                </a>
              `;

          li.querySelector("a").addEventListener("click", (e) => {
            e.preventDefault();
            window.location.href = `politica.html?id=${idPolitica}`;
          });

          ulPoliticas.appendChild(li);
        }

        renderizarTabla(politicasData);

      } catch (error) {
        console.error("‚ùå Error obteniendo pol√≠ticas:", error);
        mostrarToast("Error cargando las pol√≠ticas", "danger");
      }

      spinner.style.display = "none"; // Ocultar spinner
      document.getElementById('tablaPoliticasTable').style.display = 'table';
    }

    // Funci√≥n para renderizar la tabla
    function renderizarTabla(data) {
      tablaPoliticas.innerHTML = '';

      data.forEach(politica => {
        let row = document.createElement('tr');
        row.style.cursor = "pointer";
        row.innerHTML = `
                <td class="text-center">${politica.id}</td>
                <td class="text-start">${limitarTexto(politica.titulo, 80)}</td>
                <td class="text-center"><div class="progressBarContainerPolicy"></div></td>
                <td class="text-center">${politica.fecha}</td>
            `;
        row.addEventListener('click', () => {
          window.location.href = `politica.html?id=${politica.id}`;
        });

        tablaPoliticas.appendChild(row);

        // Se crea e inserta la barra de progreso
        const progressContainerPolicy = row.querySelector('.progressBarContainerPolicy');
        const progresoDivPolicy = document.createElement("div");
        progresoDivPolicy.classList.add("d-flex", "align-items-center", "justify-content-center", "w-100");

        const progresoTextoPolicy = document.createElement("span");
        progresoTextoPolicy.classList.add("me-2", "text-xs", "font-weight-bold");
        progresoTextoPolicy.textContent = `${politica.cumplimiento.toFixed(2)}%`;

        const progressBarContainerPolicy = document.createElement("div");
        progressBarContainerPolicy.classList.add("progress", "w-100");

        const progressBarPolicy = document.createElement("div");
        let progressBarClassPolicy = getColorClase(politica.cumplimiento);
        progressBarPolicy.classList.add("progress-bar", progressBarClassPolicy);
        progressBarPolicy.style.width = `${politica.cumplimiento}%`;

        progressBarContainerPolicy.appendChild(progressBarPolicy);
        progresoDivPolicy.appendChild(progresoTextoPolicy);
        progresoDivPolicy.appendChild(progressBarContainerPolicy);
        progressContainerPolicy.appendChild(progresoDivPolicy);
      });
    }

    // Funci√≥n para asignar colores a la barra de progreso
    function getColorClase(porcentaje) {
      if (porcentaje <= 29) return "bg-gradient-danger";
      if (porcentaje <= 60) return "bg-gradient-warning";
      if (porcentaje <= 99.9) return "bg-gradient-info";
      return "bg-gradient-success";
    }

    // üî• Llamar `cargarPoliticas()` inmediatamente al cargar la p√°gina
    cargarPoliticas();

    // Funci√≥n para ordenar tabla de pol√≠ticas
    document.querySelectorAll(".sort-icon").forEach(icon => {
      icon.addEventListener("click", () => {
        const sortKey = icon.dataset.sort;
        const order = icon.dataset.order;

        politicasData.sort((a, b) => {
          const valorA = a[sortKey];
          const valorB = b[sortKey];

          if (typeof valorA === "number" && typeof valorB === "number") {
            // Ordenar num√©rico
            return order === "asc" ? valorA - valorB : valorB - valorA;
          } else {
            // Ordenar alfab√©tico
            return order === "asc"
              ? valorA.toString().localeCompare(valorB.toString())
              : valorB.toString().localeCompare(valorA.toString());
          }
        });

        renderizarTabla(politicasData);
      });
    });


    function limitarTexto(texto, limite) {
      return texto.length > limite ? texto.substring(0, limite) + "..." : texto;
    }

    // Obtener el bot√≥n de login/logout
    const logButton = document.getElementById("logButton");

    // Variable para evitar agregar m√∫ltiples event listeners
    let logoutListenerAdded = false;

    // Verificar si el usuario est√° autenticado
    onAuthStateChanged(auth, async (user) => {
      if (user) {
        logButton.textContent = "Cerrar sesi√≥n";
        logButton.classList.remove("btn-primary");
        logButton.classList.add("btn-danger");


        // Mostrar foto y nombre de perfil
        const nombreCompleto = user.displayName || user.email || "Usuario";
        const nombreCorto = obtenerNombreCorto(nombreCompleto);
        const foto = user.photoURL
          ? user.photoURL
          : `https://ui-avatars.com/api/?name=${encodeURIComponent(nombreCorto)}&background=0D8ABC&color=fff&rounded=true&size=64`;

        if (document.getElementById("nombrePerfilUsuario")) {
          document.getElementById("nombrePerfilUsuario").textContent = nombreCompleto;
          document.getElementById("nombrePerfilUsuario").classList.add("text-dark");
          document.getElementById("nombrePerfilUsuario").classList.remove("text-white");
          document.getElementById("correoPerfilUsuario").textContent = user.email;

        }


        if (document.getElementById("imgPerfilUsuario")) {
          document.getElementById("imgPerfilUsuario").src = foto;
          document.getElementById("imgPerfilUsuario").alt = nombreCorto;
          document.getElementById("imgPerfilUsuario").title = nombreCorto;
        }

        if (document.getElementById("imgPerfilUsuarioDropdown")) {
          document.getElementById("imgPerfilUsuarioDropdown").src = foto;
          document.getElementById("imgPerfilUsuarioDropdown").alt = nombreCorto;
          document.getElementById("imgPerfilUsuarioDropdown").title = nombreCorto;
        }

        const q = query(
          collection(dbFS, "responsables"),
          where("correo", "==", user.email)
        );

        const querySnapshot = await getDocs(q);
        if (!querySnapshot.empty) {
          const doc = querySnapshot.docs[0];
          idResponsable = doc.id; // este es el ID del documento en la colecci√≥n
          console.log("ID del responsable:", idResponsable);
        } else {
          console.warn("No se encontr√≥ responsable con el correo:", user.email);
        }

        // Prevenir m√∫ltiples listeners
        if (!logoutListenerAdded) {
          logButton.addEventListener("click", () => {
            const logoutModal = new bootstrap.Modal(document.getElementById("logoutModal"));
            logoutModal.show();

            const confirmBtn = document.getElementById("confirmLogout");
            const clonedBtn = confirmBtn.cloneNode(true);
            confirmBtn.parentNode.replaceChild(clonedBtn, confirmBtn);

            clonedBtn.addEventListener("click", () => {
              signOut(auth).then(() => {
                window.location.href = "https://sigunitropico.com/plan-it-one/pages/sign-in.html";
              }).catch((error) => {
                console.error("Error al cerrar sesi√≥n:", error);
              });
            });
          });

          logoutListenerAdded = true;
        }

        // Buscar por correo sanitizado
        const correoSanitizado = user.email.replace(/\./g, "_");
        const userRef = ref(db, 'usuarios/' + correoSanitizado);

        get(userRef).then((snapshot) => {
          if (snapshot.exists()) {
            const userData = snapshot.val();
            const roles = userData.roles || [];

            console.log("Roles del usuario:", roles);

            if (roles.includes("admin-polariscore")) {
              document.querySelectorAll(".admin-polariscore").forEach(el => el.style.display = "block");
            }

            if (roles.includes("admin-polariscore") || roles.includes("responsable-polariscore")) {
              document.querySelectorAll(".admin-responsable-only").forEach(el => el.style.display = "block");
            }

          } else {
            console.warn("Usuario autenticado pero no registrado en la base de datos.");
          }
        }).catch((error) => {
          console.error("Error al obtener datos del usuario:", error);
        });

      } else {
        logButton.textContent = "Iniciar Sesi√≥n";
        logButton.classList.remove("btn-danger");
        logButton.classList.remove("text-danger");
        logButton.classList.add("btn-primary");
        logButton.classList.add("text-white");

        logButton.style.backgroundColor = "#00594e";
        logButton.style.color = "#fff!important";
        logButton.addEventListener("click", () => {
          window.location.href = "../pages/sign-in.html";
        });
      }
    });



    function obtenerNombreCorto(nombreCompleto) {
      if (!nombreCompleto) return "";
      const partes = nombreCompleto.trim().split(" ");
      if (partes.length === 1) return partes[0];
      return partes[0] + " " + partes[1];
    }




    document.getElementById("checkMisPoliticas").addEventListener("change", function () {
      if (this.checked && idResponsable) {
        const politicasFiltradas = politicasData.filter(politica =>
          politica.responsable === idResponsable
        );
        renderizarTabla(politicasFiltradas);
      } else {
        renderizarTabla(politicasData);
      }
    });



    const inputBuscar = document.getElementById('inputBuscarPoliticas');
    const iconBuscar = document.getElementById('iconBuscar');
    const contadorResultados = document.getElementById('contadorResultados');
    const placeholders = [
      "¬øQu√© pol√≠tica est√°s buscando?...",
      "Buscar por c√≥digo, t√≠tulo o palabra clave...",
      "Filtra acciones, indicadores o fechas...",
      "Explora f√°cilmente las pol√≠ticas institucionales..."
    ];

    // Animar placeholders cada 3 segundos
    let i = 0;
    setInterval(() => {
      inputBuscar.setAttribute('placeholder', placeholders[i]);
      i = (i + 1) % placeholders.length;
    }, 3000);

    // Filtro din√°mico en tiempo real
    inputBuscar.addEventListener('input', function () {
      const valorBusqueda = this.value.toLowerCase();
      const filas = document.querySelectorAll('#tablaPoliticasTable tbody tr');
      let visibles = 0;

      filas.forEach(fila => {
        const textoFila = fila.innerText.toLowerCase();
        const visible = textoFila.includes(valorBusqueda);
        fila.style.display = visible ? '' : 'none';
        if (visible) visibles++;
      });

      contadorResultados.innerText = visibles === filas.length
        ? `Mostrando todas las pol√≠ticas (${visibles})`
        : `Mostrando ${visibles} de ${filas.length} pol√≠ticas`;

      iconBuscar.className = valorBusqueda ? 'fas fa-times' : 'fas fa-search';
    });

    // Limpiar b√∫squeda con icono
    iconBuscar.addEventListener('click', function () {
      if (inputBuscar.value) {
        inputBuscar.value = '';
        inputBuscar.dispatchEvent(new Event('input'));
      }
    });


  </script>


  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <script src="https://www.gstatic.com/firebasejs/9/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9/firebase-storage.js"></script>
  <!--   Core JS Files   -->
  <script src="../assets/js/core/popper.min.js"></script>
  <script src="../assets/js/core/bootstrap.min.js"></script>
  <script src="../assets/js/plugins/perfect-scrollbar.min.js"></script>
  <script src="../assets/js/plugins/smooth-scrollbar.min.js"></script>
  <script>
    var win = navigator.platform.indexOf('Win') > -1;
    if (win && document.querySelector('#sidenav-scrollbar')) {
      var options = {
        damping: '0.5'
      }
      Scrollbar.init(document.querySelector('#sidenav-scrollbar'), options);
    }
  </script>
  <!-- Github buttons -->
  <script async defer src="https://buttons.github.io/buttons.js"></script>
  <!-- Control Center for Soft Dashboard: parallax effects, scripts for the example pages etc -->
  <script src="../assets/js/argon-dashboard.min.js?v=2.0.4"></script>
</body>
<style>
  /* Estilo para las filas de la tabla */
  #tablaPoliticas tr {
    cursor: pointer;
    /* Cambia el cursor a pointer cuando se pasa sobre la fila */
  }

  /* Cambia el color de fondo de la fila al pasar el cursor */
  #tablaPoliticas tr:hover {
    background-color: hsla(145, 83%, 48%, 0);
    /* Color verde oscuro al pasar el cursor */
    color: #000;
    font-weight: 500;
    /* Opcional: cambia el color del texto al blanco para mejor contraste */
  }

  #tablaPoliticas2 tr:hover {
    background-color: hsla(173, 100%, 17%, 0);
    /* Color verde oscuro al pasar el cursor */
    color: #ffffff;
    /* Opcional: cambia el color del texto al blanco para mejor contraste */
  }
</style>

</html>